<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>Bash Scripters: Stop using subshells to call functions. ← Machinae Elegantiam</title><meta name="author" content="Russell Harmon"/><link rel="stylesheet" href="/css/reset.css" type="text/css"/><link rel="stylesheet" href="/css/screen.css" type="text/css"/><link rel="stylesheet" href="/css/960.css" type="text/css"/><link rel="stylesheet" href="/css/syntax.css" type="text/css"/><link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Walter+Turncoat:regular"/><meta name="keywords" content="machinae"/><meta name="description" content="< p>When writing in bash, zsh, sh, etc… <strong>stop</strong> using subshells to call functions. There is a significant speed overhead to using a subshell and there is a much better alternative. Instead, you should just have a convention where a particular variable is always the return value of the function (I use <em>retval</em>). This has the added benefit of also allowing you to return arrays from your functions.</p>"/></head><body id=""><div id="site"><div id="header"><h1> <span class="nav"> <a href="/machinae" title="A programming blog">Machinae Elegantiam</a> <span class="byline">← <a href="/">Russell Harmon</a></span> </span></h1></div><div id="page"><p>When writing in bash, zsh, sh, etc… <strong>stop</strong> using subshells to call functions. There is a significant speed overhead to using a subshell and there is a much better alternative. Instead, you should just have a convention where a particular variable is always the return value of the function (I use <em>retval</em>). This has the added benefit of also allowing you to return arrays from your functions.</p><p>If you don’t know what a subshell is, a subshell is another bash shell which is spawned whenever you use <code>$()</code> or <code>` `</code> and is used to execute the code you put inside.</p><p>I did some simple testing to allow you to observe the overhead. For two functionally equivalent scripts:</p><p>This one uses a subshell:</p><div class="highlight"><pre><code class="bash"><span class="c">#!/bin/bash</span>
<span class="k">function </span>a<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo </span>hello
<span class="o">}</span>
<span class="k">for</span> <span class="o">((</span> <span class="nv">i</span> <span class="o">=</span> 0<span class="p">;</span> i &lt; 10000<span class="p">;</span> i++ <span class="o">))</span><span class="p">;</span> <span class="k">do</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">"$(a)"</span>
<span class="k">done</span></code></pre></div><p>This one uses a variable:</p><div class="highlight"><pre><code class="bash"><span class="c">#!/bin/bash</span>
<span class="k">function </span>a<span class="o">()</span> <span class="o">{</span>
    <span class="nv">retval</span><span class="o">=</span><span class="s2">"hello"</span>
<span class="o">}</span>
<span class="k">for</span> <span class="o">((</span> <span class="nv">i</span> <span class="o">=</span> 0<span class="p">;</span> i &lt; 10000<span class="p">;</span> i++ <span class="o">))</span><span class="p">;</span> <span class="k">do</span>
<span class="k">    </span>a
    <span class="nb">echo</span> <span class="s2">"$retval"</span>
<span class="k">done</span></code></pre></div><p>The speed difference between these two is noticeable and significant.</p><div class="highlight"><pre><code class="console"><span class="gp">$</span> <span class="k">for </span>i in variable subshell<span class="p">;</span> <span class="k">do</span>
<span class="gp">&gt;</span><span class="k"> </span><span class="nb">echo</span> -e <span class="s2">"\n$i"</span><span class="p">;</span> <span class="nb">time</span> ./<span class="nv">$i</span> &gt; /dev/null
<span class="gp">&gt;</span> <span class="k">done</span>

<span class="go">variable</span>

<span class="go">real 0m0.367s</span>
<span class="go">user 0m0.346s</span>
<span class="go">sys 0m0.015s</span>

<span class="go">subshell</span>

<span class="go">real 0m11.937s</span>
<span class="go">user 0m3.121s</span>
<span class="go">sys 0m0.359s</span></code></pre></div><p>As you can see, when using <code>variable</code>, execution takes 0.367 seconds. <code>subshell</code> however takes a full 11.937 seconds!</p></div><div id="disqus"><div id="disqus_thread"></div> <script>var disqus_shortname="eatnumber1",disqus_identifier="/blog/2010-07-05/subshells";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="http://"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><noscript> Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript"> comments powered by Disqus. </a> </noscript> <a href="http://disqus.com" class="dsq-brlink"> blog comments powered by <span class="logo-disqus">Disqus</span> </a></div><div id="footer"> <address> <span class="copyright"> Content by <a rel="author" href="/">Russell Harmon</a>. Design by <a href="http://mark.reid.name/info/site.html">Mark Reid</a> <br/> (<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Some rights reserved</a>) </span> <span class="engine"> Powered by <a href="http://jekyllrb.com/" title="A static, minimalist CMS">Jekyll</a>. Hosted by <a href="http://pages.github.com/">GitHub</a>. </span> <address></div></div> <script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-10349264-2"]),_gaq.push(["_trackPageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script></body></html>