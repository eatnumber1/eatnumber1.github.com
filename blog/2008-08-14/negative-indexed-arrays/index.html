<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>Negative Indexed Arrays ← Machinae Elegantiam</title><meta name="author" content="Russell Harmon"/><link rel="stylesheet" href="/css/reset.css" type="text/css"/><link rel="stylesheet" href="/css/screen.css" type="text/css"/><link rel="stylesheet" href="/css/960.css" type="text/css"/><link rel="stylesheet" href="/css/syntax.css" type="text/css"/><link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Walter+Turncoat:regular"/><meta name="keywords" content="machinae"/><meta name="description" content="The personal website and blog of Russell Harmon"/><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script><script src="https://raw.github.com/gabrielfalcao/jquery-yql/master/jquery.yql.js"></script><script src="https://raw.github.com/rmm5t/jquery-timeago/master/jquery.timeago.js"></script></head><body id=""><div id="site"><div id="header"><h1> <span class="nav"> <a href="/machinae" title="A programming blog">Machinae Elegantiam</a> <span class="byline">← <a href="/">Russell Harmon</a></span> </span></h1></div><div id="page"><p>In first describing how ridiculous C and C++ was to my class when I was in my first C++ programming course, I remember him saying that you can even create negative indexed arrays. Now that I am a bit wiser in the ways of C++ and memory management, I actually know how to do it!</p><p>The following small C++ program illustrates:</p><div class='highlight'><pre><code class='cpp'><span class='cp'>#include %MINIFYHTML1346792974%5%iostream%MINIFYHTML1346792974%6%</span>
<span class='k'>using</span> <span class='k'>namespace</span> <span class='n'>std</span><span class='p'>;</span>
<span class='kt'>int</span> <span class='n'>main</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='k'>const</span> <span class='kt'>char</span><span class='o'>**</span> <span class='n'>array</span> <span class='o'>=</span> <span class='k'>new</span> <span class='k'>const</span> <span class='kt'>char</span><span class='o'>*</span><span class='p'>[</span><span class='mi'>2</span><span class='p'>];</span>
    <span class='n'>array</span><span class='p'>[</span><span class='mi'>0</span><span class='p'>]</span> <span class='o'>=</span> <span class='s'>"Hello"</span><span class='p'>;</span>
    <span class='n'>array</span><span class='p'>[</span><span class='mi'>1</span><span class='p'>]</span> <span class='o'>=</span> <span class='s'>"World!"</span><span class='p'>;</span>
    <span class='n'>cout</span> <span class='o'>%MINIFYHTML1346792974%7%%MINIFYHTML1346792974%8%</span> <span class='p'>(</span><span class='o'>++</span><span class='n'>array</span><span class='p'>)[</span><span class='o'>-</span><span class='mi'>1</span><span class='p'>]</span> <span class='o'>%MINIFYHTML1346792974%9%%MINIFYHTML1346792974%10%</span> <span class='n'>endl</span><span class='p'>;</span>
    <span class='k'>delete</span> <span class='o'>--</span><span class='n'>array</span><span class='p'>;</span>
<span class='p'>}</span>
</code></pre>
</div><p>When executed, it gives us this:</p><div class='highlight'><pre><code class='console'><span class='gp'>$</span> g++ -Wall NegArray.cpp -o NegArray <span class='o'>%MINIFYHTML1346792974%11%%MINIFYHTML1346792974%12%</span> ./NegArray
<span class='go'>Hello</span>
</code></pre>
</div><p>The reason this happens is that since arrays in C and C++ are linear in memory, you can do math on them (the <code>++array</code> and <code>--array</code>).</p><p>So if the array looks like this:</p>

<pre><code> 0xFADC  0xFADD  %MINIFYHTML1346792974%13%-- This is the address
-----------------
| Hello | World |
-----------------</code></pre>

<p>If you printed your array (without an index), you would see <code>0xFADC</code>; the address of the first element. Therefore if you add one to that, your array’s element <code>0</code> would point at memory address <code>0xFADD</code>, and it’s element <code>-1</code> would point at memory address <code>0xFADC</code>.</p><p><em>Remember</em>, don’t try to <code>delete</code> an array like this before restoring it to the way it originally was or you will get a segfault.</p><p>A shorter way of doing it that doesn’t involve using <code>new</code> is:</p><div class='highlight'><pre><code class='cpp'><span class='cp'>#include %MINIFYHTML1346792974%14%iostream%MINIFYHTML1346792974%15%</span>
<span class='cp'>#include %MINIFYHTML1346792974%16%string%MINIFYHTML1346792974%17%</span>
<span class='k'>using</span> <span class='k'>namespace</span> <span class='n'>std</span><span class='p'>;</span>
<span class='kt'>int</span> <span class='n'>main</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='k'>const</span> <span class='n'>string</span> <span class='n'>array</span><span class='p'>[</span><span class='mi'>2</span><span class='p'>]</span> <span class='o'>=</span> <span class='p'>{</span> <span class='s'>"Hello"</span><span class='p'>,</span> <span class='s'>"World!"</span> <span class='p'>};</span>
    <span class='n'>cout</span> <span class='o'>%MINIFYHTML1346792974%18%%MINIFYHTML1346792974%19%</span> <span class='p'>((</span><span class='k'>const</span> <span class='n'>string</span><span class='o'>*</span><span class='p'>)</span> <span class='o'>%MINIFYHTML1346792974%20%</span><span class='n'>array</span> <span class='o'>+</span> <span class='mi'>1</span><span class='p'>)[</span><span class='o'>-</span><span class='mi'>1</span><span class='p'>]</span> <span class='o'>%MINIFYHTML1346792974%21%%MINIFYHTML1346792974%22%</span> <span class='n'>endl</span><span class='p'>;</span>
<span class='p'>}</span>
</code></pre>
</div><p>A probably more readable way to do it in C is as follows:</p><div class='highlight'><pre><code class='c'><span class='cp'>#include %MINIFYHTML1346792974%23%stdio.h%MINIFYHTML1346792974%24%</span>
<span class='kt'>int</span> <span class='nf'>main</span><span class='p'>()</span> <span class='p'>{</span>
	<span class='kt'>char</span> <span class='o'>*</span><span class='n'>array</span><span class='p'>[]</span> <span class='o'>=</span> <span class='p'>{</span> <span class='s'>"Hello"</span><span class='p'>,</span> <span class='s'>"World!"</span> <span class='p'>};</span>
	<span class='kt'>char</span> <span class='o'>**</span><span class='n'>ptr</span> <span class='o'>=</span> <span class='n'>array</span> <span class='o'>+</span> <span class='mi'>1</span><span class='p'>;</span>
	<span class='n'>printf</span><span class='p'>(</span><span class='s'>"%s</span><span class='se'>\n</span><span class='s'>"</span><span class='p'>,</span> <span class='n'>ptr</span><span class='p'>[</span><span class='o'>-</span><span class='mi'>1</span><span class='p'>]);</span>
<span class='p'>}</span>
</code></pre>
</div></div><div id="disqus"><div id="disqus_thread"></div><script>var disqus_shortname="eatnumber1",disqus_identifier="/blog/2008-08-14/negative-indexed-arrays";(function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="http://"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript> Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript"> comments powered by Disqus. </a> </noscript> <a href="http://disqus.com" class="dsq-brlink"> blog comments powered by <span class="logo-disqus">Disqus</span> </a></div><div id="footer"> <address> <span class="copyright"> Content by <a rel="author" href="/">Russell Harmon</a>. Design by <a href="http://mark.reid.name/info/site.html">Mark Reid</a> <br/> (<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Some rights reserved</a>) </span> <span class="engine"> Powered by <a href="http://jekyllrb.com/" title="A static, minimalist CMS">Jekyll</a>. Hosted by <a href="http://pages.github.com/">GitHub</a>. </span> <address></div></div> <script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-10349264-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>